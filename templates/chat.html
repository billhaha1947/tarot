{% extends "layout.html" %}
{% block content %}

<div class="max-w-3xl mx-auto space-y-5">
  <div class="glass p-6 rounded-2xl">
    <h2 class="text-2xl font-bold neon text-purple-400 mb-3">ğŸ”® AI Oracle Chat</h2>
    <p class="text-sm text-blue-300">Há»‡ thá»‘ng Ä‘ang cháº¡y cá»¥c bá»™ 100%, khÃ´ng dÃ¹ng API online.</p>
  </div>

  <div id="chatbox" class="glass h-[450px] overflow-y-auto p-5 rounded-2xl space-y-4"></div>

  <div class="glass p-4 rounded-2xl flex gap-3">
    <input id="chat_input" placeholder="Nháº­p cÃ¢u há»i..." 
      class="bg-black/40 flex-1 p-3 rounded-xl border border-blue-500/20 focus:outline-none focus:ring-2 focus:ring-purple-500 transition"/>
    <button onclick="sendChat()" 
      class="px-5 py-3 rounded-xl glass hover:shadow-purple-500/40 transition">Gá»­i</button>
  </div>
</div>

<script>
function addMsg(s, m){
  const box = document.getElementById("chatbox");
  const div = document.createElement("div");
  div.className = s==="ai" ?
    "text-left animate-fade-in-up" :
    "text-right animate-fade-in-up";

  const bubble = document.createElement("span");
  bubble.className = s==="ai" ?
  "inline-block px-4 py-2 rounded-xl glass text-blue-300 shadow-lg shadow-blue-500/20" :
  "inline-block px-4 py-2 rounded-xl bg-purple-600/30 border border-purple-400/20 text-purple-200 shadow-lg shadow-purple-500/20";

  bubble.textContent = m;
  div.appendChild(bubble);
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

async function sendChat(){
  const ip = document.getElementById("chat_input");
  const m = ip.value.trim(); 
  if(!m) return;
  addMsg("user", m);
  ip.value="";

  const res = await fetch("/api/chat/1",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:m})
  });
  const d = await res.json();
  if(d && d.prediction) addMsg("ai", d.prediction);
}

window.onload = () => {
  addMsg("ai","ChÃ o báº¡n, mÃ¬nh lÃ  Oracle ná»™i bá»™. HÃ£y Ä‘áº·t cÃ¢u há»i Tarot ğŸ”¥ğŸ”®");
}
</script>

{% endblock %}
